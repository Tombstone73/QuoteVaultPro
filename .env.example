# Database Configuration
# Get a free PostgreSQL database from Neon: https://neon.tech
# Format: postgresql://user:password@host/database?sslmode=require
DATABASE_URL=postgresql://user:password@host/database?sslmode=require

# Session Secret (generate a random string)
SESSION_SECRET=your-super-secret-session-key-change-this

# Node Environment
NODE_ENV=development

# Authentication Provider (REQUIRED for production)
# Development: AUTH_PROVIDER=local (default, uses simple local authentication)
# Production: AUTH_PROVIDER=replit (for Railway/Replit deployments)
# CRITICAL: Must be set to "replit" for Railway production or server will refuse to start
AUTH_PROVIDER=local

# Public App URL (REQUIRED for production Gmail OAuth)
# This is used to construct the OAuth redirect URI for Gmail
# Development: http://localhost:5000
# Production: https://www.printershero.com
PUBLIC_APP_URL=http://localhost:5000

# ===== BACKGROUND WORKERS CONFIGURATION =====
# Control background workers to prevent Neon compute burn in dev/preview environments
# 
# Global kill switch (overrides all per-worker settings):
# WORKERS_ENABLED=false    # Disables ALL workers regardless of per-worker flags
# WORKERS_ENABLED=true     # Allows per-worker flags to work (default in production)
#
# Default behavior (when WORKERS_ENABLED is not set):
# - Production: Workers default to ENABLED unless explicitly disabled
# - Non-production (dev/preview): Workers default to DISABLED unless explicitly enabled
#
# Per-worker enable/disable:
# WORKER_THUMBNAILS_ENABLED=true       # Enable thumbnail generation worker
# WORKER_ASSET_PREVIEW_ENABLED=true    # Enable asset preview worker
# WORKER_QB_SYNC_ENABLED=true          # Enable QuickBooks sync job processor
# WORKER_QB_QUEUE_ENABLED=true         # Enable QuickBooks invoice/payment queue worker
#
# Per-worker interval overrides (milliseconds):
# WORKER_THUMBNAILS_INTERVAL_MS=10000      # Thumbnail worker poll interval (default: 10s prod, 5min non-prod)
# WORKER_ASSET_PREVIEW_INTERVAL_MS=600000  # Asset preview poll interval (default: 10min prod, 5min non-prod)
# WORKER_QB_SYNC_INTERVAL_MS=30000         # QB sync job processor interval (default: 30s prod, 5min non-prod)
# WORKER_QB_QUEUE_INTERVAL_MS=300000       # QB queue worker interval (default: 5min all envs)
#
# Legacy env vars (still supported for backwards compatibility):
# THUMBNAIL_WORKER_POLL_INTERVAL_MS=10000
# QB_SYNC_QUEUE_INTERVAL_MS=300000
#
# Example: Enable only thumbnails worker in development with 1min polling:
# WORKER_THUMBNAILS_ENABLED=true
# WORKER_THUMBNAILS_INTERVAL_MS=60000

# Optional: Replit OIDC (REQUIRED when AUTH_PROVIDER=replit)
# Get these values from your Railway/Replit environment
# REPL_ID: Your Replit application ID
# REPLIT_OIDC_ISSUER: OAuth issuer URL (e.g., https://replit.com)
# These are REQUIRED for production Railway deployments
# REPL_ID=your-repl-id
# REPLIT_OIDC_ISSUER=https://replit.com
# ISSUER_URL=https://replit.com (legacy, use REPLIT_OIDC_ISSUER instead)

# QuickBooks Integration (optional)
# Get credentials from: https://developer.intuit.com
# QUICKBOOKS_CLIENT_ID=your-client-id
# QUICKBOOKS_CLIENT_SECRET=your-client-secret

# Gmail OAuth Configuration (optional, for email sending)
# GMAIL_OAUTH_REDIRECT_URI: The redirect URI registered in Google Cloud Console
# MUST match one of the Authorized Redirect URIs in your Google Cloud OAuth credentials
# Common values:
#   - OAuth Playground tokens: https://developers.google.com/oauthplayground
#   - Production app: https://www.printershero.com/api/oauth/gmail/callback
# If not set, defaults to OAuth Playground URI
# GMAIL_OAUTH_REDIRECT_URI=https://developers.google.com/oauthplayground
# QUICKBOOKS_REDIRECT_URI=http://localhost:5000/api/integrations/quickbooks/callback
# QUICKBOOKS_ENVIRONMENT=sandbox # or 'production'

# Stripe Payments v1
# STRIPE_SECRET_KEY: Stripe Dashboard → Developers → API keys (secret key)
STRIPE_SECRET_KEY=
# STRIPE_WEBHOOK_SECRET: Stripe CLI `stripe listen` output (whsec_...) or Dashboard endpoint secret
STRIPE_WEBHOOK_SECRET=
# VITE_STRIPE_PUBLISHABLE_KEY: Stripe Dashboard → Developers → API keys (publishable key)
VITE_STRIPE_PUBLISHABLE_KEY=

# ===== HARDENING PASS 2: STABILITY & ABUSE RESISTANCE =====
# Production-readiness controls for multi-tenant SaaS deployment
# All features are runtime-configurable and can be disabled without code changes

# Rate Limiting (protects against abuse and volumetric attacks)
# FEATURE_RATE_LIMITING_ENABLED=true              # Global kill switch for all rate limiting (default: true)
# RATE_LIMIT_GLOBAL_IP_MAX=1000                   # Global IP rate limit max requests (default: 1000)
# RATE_LIMIT_GLOBAL_IP_WINDOW_MS=900000           # Global IP rate limit window in ms (default: 15min)
# RATE_LIMIT_AUTH_MAX=5                           # Auth endpoint max attempts per IP (default: 5)
# RATE_LIMIT_AUTH_WINDOW_MS=900000                # Auth rate limit window in ms (default: 15min)
# RATE_LIMIT_CALCULATE_MAX=10                     # Calculate endpoint max per user/min (default: 10)
# RATE_LIMIT_CALCULATE_WINDOW_MS=60000            # Calculate window in ms (default: 1min)
# RATE_LIMIT_EMAIL_MAX=5                          # Email sending max per user/hour (default: 5)
# RATE_LIMIT_EMAIL_WINDOW_MS=3600000              # Email window in ms (default: 1hr)
# RATE_LIMIT_PREPRESS_MAX=3                       # Prepress job max per user (default: 3)
# RATE_LIMIT_PREPRESS_WINDOW_MS=300000            # Prepress window in ms (default: 5min)
# RATE_LIMIT_WRITE_MAX=100                        # Write operations max per user (default: 100)
# RATE_LIMIT_WRITE_WINDOW_MS=900000               # Write operations window in ms (default: 15min)

# Upload Safety (file upload validation and abuse prevention)
# FEATURE_UPLOAD_VALIDATION_ENABLED=true          # Kill switch for upload validation (default: true)
# MAX_CONCURRENT_UPLOADS_PER_USER=3               # Concurrent uploads per user (default: 3)
# UPLOAD_LOCK_TTL_MS=300000                       # Upload lock TTL failsafe in ms (default: 5min)

# Request Body Size Limits (prevent memory exhaustion)
# MAX_JSON_BODY_SIZE=100kb                        # Default JSON body size limit (default: 100kb)
# MAX_CALCULATE_BODY_SIZE=500kb                   # Calculate endpoint body limit (default: 500kb)

# Health Checks (orchestrator probes - ALWAYS ON, cannot be disabled)
# HEALTH_DB_TIMEOUT_MS=2000                       # Database health check timeout (default: 2s)
# HEALTH_DB_CACHE_MS=5000                         # Database health check cache (default: 5s)

# Graceful Shutdown (clean deployment handling)
# FEATURE_GRACEFUL_SHUTDOWN_ENABLED=true          # Kill switch for graceful shutdown (default: true)
# GRACEFUL_SHUTDOWN_TIMEOUT_MS=30000              # Max wait for in-flight requests (default: 30s)

